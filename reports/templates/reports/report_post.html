{% load static %}
<article class="report-post card mb-4 shadow-sm">
  
  <header class="card-header d-flex align-items-center" style="background: transparent; border-bottom: 0">
    <div class="me-3">
      <a href="{% url 'public_profile' report.author.username %}" class="text-decoration-none">
      {% if report.author_avatar_url %}
      <img
        src="{{ report.author_avatar_url }}"
        class="rounded-circle"
        alt="{{ report.author_display_name }}"
        style="width: 48px; height: 48px;user-select: none;"
        draggable="false"
      />
      </a>
      {% else %}
      <div
        class="avatar-fallback rounded-circle d-flex align-items-center justify-content-center"
        style="width: 48px; height: 48px; background-color: var(--hover); color: var(--text-primary);user-select: none;"
      >
        <i class="fas fa-user"></i>
      </div>
      {% endif %}
    </div>
    <div class="flex-grow-1">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div class="small mb-2" style="color: var(--text-secondary)">
            <i class="fas fa-tag me-1"></i>
            <span class="fw-bold">{{ report.get_category_display }}</span>
            <span class="mx-1">‚Ä¢</span>
            <i class="far fa-clock me-1"></i>
            {{ report.created_at|date:"d M Y, H:i" }} WIB
          </div>
          <h5 class="card-title mb-0">
            <a href="{% url 'public_profile' report.author.username %}" class="text-decoration-none text-reset" style="user-select: none;" draggable="false">
              <strong>{{ report.author_display_name }}</strong>
            </a>
          </h5>
        </div>

        <div class="small text-end ms-3">
          <span class="badge bg-info text-dark ms-1">
            {{ report.get_status_display }}
          </span>
        </div>
      </div>
    </div>
  </header>

<div class="card-body">
    
    <p class="lead report-description mb-3">
      <strong class="d-block mb-2">{{ report.title }}</strong>
      
      <span>{{ report.description|linebreaks }}</span>
    </p>

    <section class="mt-3">
      {% if report.ai_summary %}
      <div class="ai-summary p-3 rounded">
        <div class="small mb-2 text-uppercase fw-bold">Rangkuman (generated)</div>
        
        <div>{{ report.ai_summary|linebreaks }}</div>
      </div>
      {% endif %}
    </section>

    <section class="mt-3">
{% if report.attachment %}
<div class="attachment-wrapper mt-2">
    
    {% with ext=report.attachment.name|lower|slice:"-4:" %}
    
    <div class="d-flex align-items-center gap-2 p-2 border rounded bg-dark">
        <div class="file-icon">
            {% if ".pdf" in ext %}<i class="fas fa-file-pdf text-danger fa-2x"></i>
            {% elif ".jpg" in ext or ".png" in ext or ".jpeg" in ext %}<i class="fas fa-file-image text-info fa-2x"></i>
            {% elif ".doc" in ext %}<i class="fas fa-file-word text-primary fa-2x"></i>
            {% else %}<i class="fas fa-file text-secondary fa-2x"></i>{% endif %}
        </div>

        <div class="file-info flex-grow-1 overflow-hidden">
            <div class="text-dark fw-bold small">{{ report.attachment.name }}</div>
            <div class="small text-dark">Document</div>
        </div>

        <div class="file-actions">
            
            <a href="{{ report.attachment.url }}" download class="btn btn-sm btn-dark border-secondary" title="Download">
                <i class="fas fa-download"></i>
            </a>

            {% if ".pdf" in ext or ".jpg" in ext or ".png" in ext %}
                <a href="{% url 'reports:preview_file' report.id %}" 
                   class="btn btn-sm btn-primary preview-trigger"
                   data-file-type="native" 
                   title="Preview">
                    <i class="fas fa-eye"></i>
                </a>
            
            {% elif ".doc" in ext or ".ppt" in ext or ".xls" in ext %}
                <a href="https://docs.google.com/viewer?url={{ request.scheme }}://{{ request.get_host }}{{ report.attachment.url }}&embedded=true" 
                   class="btn btn-sm btn-primary preview-trigger"
                   data-file-type="office"
                   title="Preview">
                    <i class="fas fa-eye"></i>
                </a>
            {% endif %}

        </div>
    </div>
    {% endwith %}

</div>
{% endif %}
    </section>
  </div>

  <footer class="card-footer border-top-0 d-flex align-items-center justify-content-between">
    <div class="d-flex gap-2 align-items-center flex-wrap">
      
      <button class="btn btn-sm btn-reaction" onclick="submitReaction('{{ report.id }}','agree', this)" title="Agree">
        <i>üëçüèº</i>
        <span id="count-agree-{{ report.id }}" class="ms-2">{{ report.agree_count }}</span>
      </button>

      <button class="btn btn-sm btn-reaction" onclick="submitReaction('{{ report.id }}','support', this)" title="Support">
        <i>üî•</i>
        <span id="count-support-{{ report.id }}" class="ms-2">{{ report.support_count }}</span>
      </button>

      <button class="btn btn-sm btn-reaction" onclick="submitReaction('{{ report.id }}','sad', this)" title="Sad">
        <i>üò¢</i>
        <span id="count-sad-{{ report.id }}" class="ms-2">{{ report.sad_count }}</span>
      </button>

      <button class="btn btn-sm btn-reaction" onclick="submitReaction('{{ report.id }}','shock', this)" title="Shock">
        <i>üò≤</i>
        <span id="count-shock-{{ report.id }}" class="ms-2">{{ report.shock_count }}</span>
      </button>

      <button class="btn btn-sm btn-reaction" onclick="submitReaction('{{ report.id }}','confused', this)" title="Confused">
        <i>ü§î</i>
        <span id="count-confused-{{ report.id }}" class="ms-2">{{ report.confused_count }}</span>
      </button>
    </div>
  </footer>
</article>